@model IEnumerable<COLAFHotel.Models.Booking>
@{
    ViewBag.Title = "Bookings";
    var successMessage = TempData["Success"] as string;
    var bookingId = TempData["BookingId"] != null ? Convert.ToInt32(TempData["BookingId"]) : 0;
    var checkInDate = TempData["CheckInDate"] as string;
    var checkOutDate = TempData["CheckOutDate"] as string;
    var totalAmount = TempData["TotalAmount"] != null ? Convert.ToDecimal(TempData["TotalAmount"]) : 0;
}
<!--
    TODO:
    1. Improve the design for the table
    2. If status is pending allow guest to edit and confirmed the booking process
    3. Allow user to cancel the booking process
    4. Functional View Details
-->
<div class="container mx-auto p-6 pt-[6rem]">
    <h3 class="text-xl font-semibold text-white rounded-lg bg-[var(--primary-color)] mb-4 p-2 inline-block">Booking History</h3>

    <div class="overflow-x-auto bg-white shadow-md rounded-lg">
        <table class="w-full border-collapse">
            <thead>
                <tr class="bg-gray-100 border-b">
                    <th class="py-3 px-4 text-left text-gray-700 font-medium">Booking ID</th>
                    <th class="py-3 px-4 text-left text-gray-700 font-medium">Room</th>
                    <th class="py-3 px-4 text-left text-gray-700 font-medium">Check-In</th>
                    <th class="py-3 px-4 text-left text-gray-700 font-medium">Check-Out</th>
                    <th class="py-3 px-4 text-left text-gray-700 font-medium">Status</th>
                    <th class="py-3 px-4 text-left text-gray-700 font-medium">Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var booking in Model)
                {
                    <tr class="border-b hover:bg-gray-50 transition">
                        <td class="py-3 px-4 text-gray-800">@booking.booking_id</td>
                        <td class="py-3 px-4 text-gray-600">@booking.Room.RoomNumber</td>
                        <td class="py-3 px-4 text-gray-600">@booking.check_in_date.ToString("yyyy-MM-dd")</td>
                        <td class="py-3 px-4 text-gray-600">@booking.check_out_date.ToString("yyyy-MM-dd")</td>
                        <td class="py-3 px-4">
                            <span class="px-2 py-1 text-sm font-medium rounded-md
                                @(booking.status == "Confirmed" ? "bg-green-200 text-green-800" :
                                    booking.status == "Pending" ? "bg-yellow-200 text-yellow-800" : "bg-red-200 text-red-800")">
                                @booking.status
                            </span>
                        </td>
                        <td class="py-3 px-4">
                            <a asp-action="Details" asp-route-id="@booking.booking_id"
                               class="text-blue-600 hover:underline text-sm">View Details</a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>


@if (!string.IsNullOrEmpty(successMessage))
{
    <div id="bookingModal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50">
        <div class="bg-white p-6 rounded-2xl shadow-xl w-full max-w-md transform transition-all duration-300 scale-100">
            <h2 class="text-xl font-semibold text-gray-800">🎉 Booking Confirmed!</h2>
            <p class="mt-2 text-gray-600">@successMessage</p>

            <div class="mt-4 space-y-2 text-gray-700">
                <p><strong>Booking ID:</strong> @bookingId</p>
                <p><strong>Check-in Date:</strong> @checkInDate</p>
                <p><strong>Check-out Date:</strong> @checkOutDate</p>
                <p><strong>Total Amount:</strong> $@totalAmount</p>
            </div>

            <div class="mt-6 flex justify-end">
                <button id="closeModal" class="px-4 py-2 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition">
                    OK
                </button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            document.getElementById("closeModal").addEventListener("click", function () {
                document.getElementById("bookingModal").style.display = "none";
            });
        });
    </script>
}
