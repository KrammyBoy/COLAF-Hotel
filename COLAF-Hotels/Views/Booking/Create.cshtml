@model COLAFHotel.Models.Room
@inject IHttpContextAccessor HttpContextAccessor
@{
    ViewBag.Title = "Create Booking";
    var user = HttpContextAccessor.HttpContext?.Session.GetString("User");
    var role = HttpContextAccessor.HttpContext?.Session.GetString("Role");
    var isGuest = HttpContextAccessor.HttpContext?.Session.GetString("GuestId");
    var user_id = HttpContextAccessor.HttpContext?.Session.GetString("UserId");
}

<div class="min-h-screen bg-coffee-cream bg-opacity-30 w-full p-6">
    @if (!string.IsNullOrEmpty(role))
    {
        <div class="max-w-5xl mx-auto bg-white rounded-2xl shadow-xl overflow-hidden">
            <!-- Header with Room Image -->
            <div class="relative h-80 sm:h-96">
                <img src="@Url.Content(Model.ImageUrl)" class="w-full h-full object-cover" alt="Room @Model.RoomNumber" />
                <div class="absolute inset-0 bg-gradient-to-t from-coffee-dark to-transparent opacity-60"></div>
                <div class="absolute bottom-0 left-0 p-6 text-white">
                    <h1 class="text-4xl font-bold mb-2">Room @Model.RoomNumber</h1>
                    <div class="flex items-center space-x-2">
                        <span class="bg-coffee-accent text-white px-3 py-1 rounded-full text-sm">@Model.Category</span>
                        <span class="bg-coffee-medium text-white px-3 py-1 rounded-full text-sm">₱@Model.Price.ToString("N2")/night</span>
                    </div>
                </div>
            </div>

            <!-- Booking Form -->
            <form method="post" class="p-6" method="POST">
                <input type="hidden" name="RoomId" value="@Model.RoomId" />
                <input type="hidden" name="RoomNumber" value="@Model.RoomNumber" />
                <input type="hidden" name="Category" value="@Model.Category" />
                <input type="hidden" name="ImageUrl" value="@Model.ImageUrl" />
                <input type="hidden" name="Price" value="@Model.Price" />
                <input type="hidden" name="UserId" value="@user_id" />
                <input type="hidden" name="GuestId" value="@isGuest" />
                <input type="hidden" name="totalBalance" value="0" id="hiddenTotalBalance" />
                <input type="hidden" name="totalPrice" id="hiddenTotalPrice" />
                <input type="hidden" name="haveTransport" id="hiddenTransportService" />

                <!-- Room Features -->
                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-coffee-dark mb-4">Room Details</h2>
                    <div class="grid grid-cols-2 sm:grid-cols-3 gap-4">
                        <div class="flex items-center p-3 bg-coffee-cream bg-opacity-20 rounded-lg">
                            <i class="fas fa-bed text-coffee-accent mr-3 text-xl"></i>
                            <span class="text-coffee-medium">@Model.Category</span>
                        </div>
                        <div class="flex items-center p-3 bg-coffee-cream bg-opacity-20 rounded-lg">
                            <i class="fas fa-user-friends text-coffee-accent mr-3 text-xl"></i>
                            <span class="text-coffee-medium">2-4 Guests</span>
                        </div>
                        <div class="flex items-center p-3 bg-coffee-cream bg-opacity-20 rounded-lg">
                            <i class="fas fa-wifi text-coffee-accent mr-3 text-xl"></i>
                            <span class="text-coffee-medium">Free WiFi</span>
                        </div>
                        <div class="flex items-center p-3 bg-coffee-cream bg-opacity-20 rounded-lg">
                            <i class="fas fa-snowflake text-coffee-accent mr-3 text-xl"></i>
                            <span class="text-coffee-medium">Air Conditioned</span>
                        </div>
                        <div class="flex items-center p-3 bg-coffee-cream bg-opacity-20 rounded-lg">
                            <i class="fas fa-tv text-coffee-accent mr-3 text-xl"></i>
                            <span class="text-coffee-medium">Flat-screen TV</span>
                        </div>
                        <div class="flex items-center p-3 bg-coffee-cream bg-opacity-20 rounded-lg">
                            <i class="fas fa-bath text-coffee-accent mr-3 text-xl"></i>
                            <span class="text-coffee-medium">Private Bathroom</span>
                        </div>
                    </div>
                </div>

                <!-- Dates Section -->
                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-coffee-dark mb-4">Select Dates</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="group">
                            <label class="block text-coffee-medium font-medium mb-2">Check-in Date</label>
                            <div class="relative">
                                <input type="text" id="checkInDate" name="CheckInDate"
                                       class="datepicker w-full p-3 border border-coffee-cream rounded-lg pl-10 focus:ring-2 focus:ring-coffee-accent focus:border-coffee-accent transition-all"
                                       onchange="updatePrice()" required>
                                <i class="fa-solid fa-calendar-days absolute left-3 top-3 text-coffee-light group-hover:text-coffee-accent transition-colors duration-200"></i>
                            </div>
                        </div>
                        <div class="group">
                            <label class="block text-coffee-medium font-medium mb-2">Check-out Date</label>
                            <div class="relative">
                                <input type="text" id="checkOutDate" name="CheckOutDate"
                                       class="datepicker w-full p-3 border border-coffee-cream rounded-lg pl-10 focus:ring-2 focus:ring-coffee-accent focus:border-coffee-accent transition-all"
                                       onchange="updatePrice()" required>
                                <i class="fa-solid fa-calendar-days absolute left-3 top-3 text-coffee-light group-hover:text-coffee-accent transition-colors duration-200"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Transport Services -->
                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-coffee-dark mb-4">Transport Service</h2>
                    <div class="bg-coffee-cream bg-opacity-10 rounded-xl p-5 border border-coffee-cream">
                        <!-- Header with checkbox -->
                        <div class="flex items-center gap-3 border-b border-coffee-cream pb-4">
                            <input type="checkbox" id="transportService" name="TransportService"
                                   class="w-6 h-6 rounded text-coffee-accent border-coffee-light focus:ring-coffee-accent cursor-pointer"
                                   onchange="toggleTransportDetails()">
                            <label for="transportService" class="text-lg font-medium text-coffee-dark cursor-pointer">
                                Include Hotel Transport Service (+₱500)
                            </label>
                        </div>

                        <!-- Transport Service Information -->
                        <div id="transportDetails" class="hidden mt-5">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <!-- Arrival -->
                                <div class="bg-white p-4 rounded-lg shadow-sm">
                                    <h3 class="text-xl font-semibold text-coffee-dark flex items-center mb-3">
                                        <i class="fas fa-plane-arrival text-coffee-accent mr-2"></i>
                                        Arrival
                                    </h3>
                                    <div class="space-y-3">
                                        <div>
                                            <label class="block text-sm font-medium text-coffee-medium mb-1">Arrival Time</label>
                                            <select class="w-full p-2 border border-coffee-cream rounded-lg bg-coffee-cream bg-opacity-10 focus:ring-2 focus:ring-coffee-accent">
                                                <option>9:00 AM</option>
                                                <option>10:00 AM</option>
                                                <option>11:00 AM</option>
                                                <option>12:00 PM</option>
                                                <option>1:00 PM</option>
                                                <option>2:00 PM</option>
                                                <option>3:00 PM</option>
                                                <option>4:00 PM</option>
                                                <option>5:00 PM</option>
                                                <option>6:00 PM</option>
                                                <option>7:00 PM</option>
                                                <option>8:00 PM</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-coffee-medium mb-1">Arriving From</label>
                                            <input type="text" class="w-full p-2 border border-coffee-cream rounded-lg bg-coffee-cream bg-opacity-10 focus:ring-2 focus:ring-coffee-accent" placeholder="Enter pickup location">
                                        </div>
                                    </div>
                                </div>

                                <!-- Departure -->
                                <div class="bg-white p-4 rounded-lg shadow-sm">
                                    <h3 class="text-xl font-semibold text-coffee-dark flex items-center mb-3">
                                        <i class="fas fa-plane-departure text-coffee-accent mr-2"></i>
                                        Departure
                                    </h3>
                                    <div class="space-y-3">
                                        <div>
                                            <label class="block text-sm font-medium text-coffee-medium mb-1">Departure Time</label>
                                            <select class="w-full p-2 border border-coffee-cream rounded-lg bg-coffee-cream bg-opacity-10 focus:ring-2 focus:ring-coffee-accent">
                                                <option>9:00 AM</option>
                                                <option>10:00 AM</option>
                                                <option>11:00 AM</option>
                                                <option>12:00 PM</option>
                                                <option>1:00 PM</option>
                                                <option>2:00 PM</option>
                                                <option>3:00 PM</option>
                                                <option>4:00 PM</option>
                                                <option>5:00 PM</option>
                                                <option>6:00 PM</option>
                                                <option>7:00 PM</option>
                                                <option>8:00 PM</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-coffee-medium mb-1">Departing To</label>
                                            <input type="text" class="w-full p-2 border border-coffee-cream rounded-lg bg-coffee-cream bg-opacity-10 focus:ring-2 focus:ring-coffee-accent" placeholder="Enter dropoff location">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-4 text-right">
                                <button onclick="clearTransportDetails()" type="button" class="text-coffee-accent hover:text-coffee-dark font-medium transition-colors">
                                    <i class="fas fa-times-circle mr-1"></i> Clear Details
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!--Payment-->
                <div class="bg-white rounded-xl shadow-lg overflow-hidden border border-coffee-cream p-6">
                    <h2 class="text-2xl font-bold text-coffee-dark mb-4">Payment Method</h2>
                    <div class="bg-coffee-cream bg-opacity-10 rounded-lg p-5 border border-coffee-cream mb-6">
                        <!-- Credit Card Payment Form -->
                        <div id="creditCardForm" class="space-y-6">
                            <div class="flex items-center justify-center sm:justify-start space-x-4 mb-5">
                                <img src="https://upload.wikimedia.org/wikipedia/commons/4/41/Visa_Logo.png" alt="Visa" class="h-10 transition-transform duration-300 hover:scale-110 cursor-pointer">
                                <img src="https://upload.wikimedia.org/wikipedia/commons/b/b7/MasterCard_Logo.svg" alt="Mastercard" class="h-10 transition-transform duration-300 hover:scale-110 cursor-pointer">
                                <img src="https://upload.wikimedia.org/wikipedia/commons/3/30/American_Express_logo.svg" alt="Amex" class="h-10 transition-transform duration-300 hover:scale-110 cursor-pointer">
                                <div class="px-3 py-1 bg-coffee-dark text-coffee-cream rounded-full text-xs font-medium flex items-center gap-1">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                                    </svg>
                                    Secure Payment
                                </div>
                            </div>

                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-coffee-medium mb-2" for="cardNumber">Card Number</label>
                                    <div class="relative">
                                        <input type="text" class="w-full p-3 border border-coffee-cream rounded-lg pl-10 bg-white focus:ring-2 focus:ring-coffee-accent focus:border-coffee-accent transition-all duration-300" id="cardNumber" placeholder="1234 5678 9012 3456" required>
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 absolute left-3 top-3.5 text-coffee-light" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" />
                                        </svg>
                                    </div>
                                </div>

                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-coffee-medium mb-2" for="expirationDate">Expiration Date</label>
                                        <input type="text" class="w-full p-3 border border-coffee-cream rounded-lg bg-white focus:ring-2 focus:ring-coffee-accent focus:border-coffee-accent transition-all duration-300" id="expirationDate" placeholder="MM/YY" required>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-coffee-medium mb-2" for="CVV">Security Code (CVV)</label>
                                        <div class="relative">
                                            <input type="text" class="w-full p-3 border border-coffee-cream rounded-lg pl-10 bg-white focus:ring-2 focus:ring-coffee-accent focus:border-coffee-accent transition-all duration-300" id="CVV" placeholder="123" required>
                                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 absolute left-3 top-3.5 text-coffee-light" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                                            </svg>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Payment Option Selection -->
                    <div class="mb-6">
                        <label for="paymentOption" class="block text-sm font-medium text-coffee-medium mb-2">Payment Type</label>
                        <div class="relative">
                            <select id="paymentOption" class="appearance-none w-full p-3 border border-coffee-cream rounded-lg bg-white focus:ring-2 focus:ring-coffee-accent pr-10 focus:border-coffee-accent transition-all duration-300" onchange="updatePrice()">
                                <option value="Full Payment">Full Payment</option>
                                <option value="Deposit">Deposit (25%)</option>
                            </select>
                            <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
                                <svg class="w-5 h-5 text-coffee-medium" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                                </svg>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Booking Policies -->
                <div class="bg-white rounded-xl shadow-lg overflow-hidden border border-coffee-cream mt-5">
                    <!-- Header -->
                    <div class="bg-coffee-dark px-6 py-4 border-b border-coffee-light">
                        <h2 class="text-xl font-semibold text-coffee-cream flex items-center">
                            <i class="fas fa-clipboard-list text-coffee-accent mr-3"></i>
                            Hotel Booking Policy
                        </h2>
                    </div>

                    <!-- Booking Policy -->
                    <div class="p-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <!-- Left Column -->
                            <div class="space-y-4">
                                <div class="flex items-start">
                                    <div class="bg-coffee-cream bg-opacity-30 p-2 rounded-lg text-coffee-accent mr-3">
                                        <i class="fas fa-calendar-check"></i>
                                    </div>
                                    <div>
                                        <h3 class="font-medium text-coffee-dark">Reservation Confirmation</h3>
                                        <p class="text-coffee-medium text-sm mt-1">Your stay is secured once full payment is received. A confirmation email will be sent immediately.</p>
                                    </div>
                                </div>

                                <div class="flex items-start">
                                    <div class="bg-coffee-cream bg-opacity-30 p-2 rounded-lg text-coffee-accent mr-3">
                                        <i class="fas fa-ban"></i>
                                    </div>
                                    <div>
                                        <h3 class="font-medium text-coffee-dark">Cancellation Policy</h3>
                                        <p class="text-coffee-medium text-sm mt-1">Cancel <span class="font-medium">at least 48 hours</span> before check-in for a full refund. Late cancellations may incur a charge.</p>
                                    </div>
                                </div>

                                <div class="flex items-start">
                                    <div class="bg-coffee-cream bg-opacity-30 p-2 rounded-lg text-coffee-accent mr-3">
                                        <i class="fas fa-exchange-alt"></i>
                                    </div>
                                    <div>
                                        <h3 class="font-medium text-coffee-dark">Modification Policy</h3>
                                        <p class="text-coffee-medium text-sm mt-1">Need to adjust your dates? Changes are allowed up to <span class="font-medium">24 hours</span> before check-in, subject to availability.</p>
                                    </div>
                                </div>

                                <div class="flex items-start">
                                    <div class="bg-coffee-cream bg-opacity-30 p-2 rounded-lg text-coffee-accent mr-3">
                                        <i class="fas fa-credit-card"></i>
                                    </div>
                                    <div>
                                        <h3 class="font-medium text-coffee-dark">Payment Terms</h3>
                                        <p class="text-coffee-medium text-sm mt-1">We accept all major credit cards and digital payments. Your booking is only confirmed once payment is processed.</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Right Column -->
                            <div class="space-y-4">
                                <div class="flex items-start">
                                    <div class="bg-coffee-cream bg-opacity-30 p-2 rounded-lg text-coffee-accent mr-3">
                                        <i class="fas fa-user-times"></i>
                                    </div>
                                    <div>
                                        <h3 class="font-medium text-coffee-dark">No-Show Policy</h3>
                                        <p class="text-coffee-medium text-sm mt-1">If you don't check in on the scheduled date, your reservation will be forfeited, and no refunds will be issued.</p>
                                    </div>
                                </div>

                                <div class="flex items-start">
                                    <div class="bg-coffee-cream bg-opacity-30 p-2 rounded-lg text-coffee-accent mr-3">
                                        <i class="fas fa-clock"></i>
                                    </div>
                                    <div>
                                        <h3 class="font-medium text-coffee-dark">Check-in & Check-out</h3>
                                        <p class="text-coffee-medium text-sm mt-1">Check-in is from <span class="font-medium">2:00 PM</span>, and check-out is by <span class="font-medium">11:00 AM</span>. Early check-in or late check-out is subject to availability and extra charges.</p>
                                    </div>
                                </div>

                                <div class="flex items-start">
                                    <div class="bg-coffee-cream bg-opacity-30 p-2 rounded-lg text-coffee-accent mr-3">
                                        <i class="fas fa-id-card"></i>
                                    </div>
                                    <div>
                                        <h3 class="font-medium text-coffee-dark">Guest Policy</h3>
                                        <p class="text-coffee-medium text-sm mt-1">A valid ID is required at check-in. Additional guests may be subject to extra charges.</p>
                                    </div>
                                </div>

                                <div class="flex items-start">
                                    <div class="bg-coffee-cream bg-opacity-30 p-2 rounded-lg text-coffee-accent mr-3">
                                        <i class="fas fa-headset"></i>
                                    </div>
                                    <div>
                                        <h3 class="font-medium text-coffee-dark">Contact Support</h3>
                                        <p class="text-coffee-medium text-sm mt-1">For any booking changes or questions, reach out to our front desk <span class="font-medium">at least 24 hours</span> before your stay.</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Footer with help link -->
                    <div class="bg-coffee-cream bg-opacity-20 px-6 py-3 border-t border-coffee-cream">
                        <a href="#" class="flex items-center justify-center text-coffee-medium hover:text-coffee-dark transition-colors">
                            <i class="fas fa-question-circle mr-2"></i>
                            <span>Need more information? View our full terms and conditions</span>
                        </a>
                    </div>
                </div>

                <!-- Price Details -->
                <div class="bg-white rounded-xl shadow-lg overflow-hidden border border-coffee-cream mt-8">
                    <!-- Header -->
                    <div class="bg-coffee-dark px-6 py-4">
                        <h2 class="text-xl font-semibold text-coffee-cream flex items-center">
                            <i class="fas fa-receipt text-coffee-accent mr-3"></i>
                            Price Breakdown
                        </h2>
                    </div>

                    <!-- Content -->
                    <div class="p-6">
                        <!-- Date Range Summary -->
                        <div class="mb-6 bg-coffee-cream bg-opacity-20 rounded-lg p-4 flex items-center">
                            <div class="bg-coffee-medium rounded-lg p-2 mr-4 text-white">
                                <i class="fas fa-calendar-alt"></i>
                            </div>
                            <div>
                                <p class="text-coffee-medium text-sm">Your Stay</p>
                                <p class="text-coffee-dark font-medium">
                                    <span id="checkInDay">Check-in Day</span> -
                                    <span id="checkOutDay">Check-out Day</span>
                                    (<span id="numberOfNights" class="text-coffee-accent font-semibold">0</span> Nights)
                                </p>
                            </div>
                        </div>

                        <!-- Price Items -->
                        <div class="space-y-4">
                            <!-- Room Price -->
                            <div class="flex justify-between items-center border-b border-coffee-cream pb-4">
                                <div class="flex items-center">
                                    <div class="w-10 h-10 bg-coffee-cream bg-opacity-30 rounded-lg flex items-center justify-center mr-3 text-coffee-medium">
                                        <i class="fas fa-bed"></i>
                                    </div>
                                    <div>
                                        <p class="text-coffee-dark font-medium">@Model.Category Room (R @Model.RoomNumber)</p>
                                        <p class="text-coffee-medium text-xs">Base room rate</p>
                                    </div>
                                </div>
                                <p class="text-coffee-dark font-semibold">₱@Model.Price.ToString("N2")</p>
                            </div>

                            <!-- Nights of Stay -->
                            <div class="flex justify-between items-center border-b border-coffee-cream pb-4">
                                <div class="flex items-center">
                                    <div class="w-10 h-10 bg-coffee-cream bg-opacity-30 rounded-lg flex items-center justify-center mr-3 text-coffee-medium">
                                        <i class="fas fa-moon"></i>
                                    </div>
                                    <div>
                                        <p class="text-coffee-dark font-medium">Nights of Stay</p>
                                        <p class="text-coffee-medium text-xs"><span id="numberOfNights2">0</span> nights at room rate</p>
                                    </div>
                                </div>
                                <p class="text-coffee-dark font-semibold">₱<span id="nightPrice">0</span></p>
                            </div>

                            <!-- Transport Fee -->
                            <div class="flex justify-between items-center border-b border-coffee-cream pb-4">
                                <div class="flex items-center">
                                    <div class="w-10 h-10 bg-coffee-cream bg-opacity-30 rounded-lg flex items-center justify-center mr-3 text-coffee-medium">
                                        <i class="fas fa-car"></i>
                                    </div>
                                    <div>
                                        <p class="text-coffee-dark font-medium">Transport Service Fee</p>
                                        <p class="text-coffee-medium text-xs">Optional shuttle service</p>
                                    </div>
                                </div>
                                <p class="text-coffee-dark font-semibold">₱<span id="transportFee">0</span></p>
                            </div>

                            <!-- Discount -->
                            <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center border-b border-coffee-cream pb-4 gap-3">
                                <div class="flex items-center">
                                    <div class="w-10 h-10 bg-coffee-cream bg-opacity-30 rounded-lg flex items-center justify-center mr-3 text-coffee-medium">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                        </svg>
                                    </div>
                                    <div>
                                        <p class="text-coffee-dark font-medium">No Discount</p>
                                        <p class="text-coffee-medium text-xs mt-1">Discount</p>
                                    </div>
                                </div>
                                <p class="text-coffee-dark font-semibold ml-13 sm:ml-0">₱<span id="discountPrice">0</span></p>
                            </div>

                            <!-- Payment Type-->
                            <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center border-b border-coffee-cream pb-4 gap-3">
                                <div class="flex items-center">
                                    <div class="w-10 h-10 bg-coffee-cream bg-opacity-30 rounded-lg flex items-center justify-center mr-3 text-coffee-medium">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2z" />
                                        </svg>
                                    </div>
                                    <div>
                                        <p class="text-coffee-dark font-medium">Payment Type</p>
                                        <p class="text-coffee-medium text-xs mt-1">Deposit or Full Payment</p>
                                    </div>
                                </div>
                                <div class="bg-coffee-medium text-white text-sm px-3 py-1 rounded-full ml-13 sm:ml-0">
                                    <span id="paymentType">Full Payment</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Total Section -->
                    <div class="bg-coffee-cream bg-opacity-30 p-6 border-t border-coffee-cream">
                        <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center mb-4">
                            <div class="mb-3 sm:mb-0">
                                <p class="text-coffee-medium text-sm font-medium">Total Amount</p>
                                <p class="text-coffee-dark text-2xl font-bold mt-1">₱<span id="totalPrice">0.00</span></p>
                            </div>
                            <div class="bg-coffee-accent hover:bg-coffee-dark transition-colors duration-300 text-white px-4 py-2 rounded-lg flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                                Final Price
                            </div>
                        </div>

                        <!--Deposit Section-->
                        <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center pt-4 border-t border-coffee-cream border-opacity-50">
                            <div class="mb-3 sm:mb-0">
                                <p class="text-coffee-medium text-sm font-medium">Deposit</p>
                                <p class="text-coffee-dark text-xl font-semibold mt-1">₱<span id="totalDeposit">0.00</span></p>
                            </div>
                            <div class="bg-coffee-medium hover:bg-coffee-dark transition-colors duration-300 text-white px-4 py-2 rounded-lg flex items-center">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                                <span id="paymentTypeFinal">Final Deposit</span> <!-- Value can be "Final Deposit" or "No Deposit"-->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="mt-8 flex flex-col sm:flex-row gap-4">
                    <button type="submit" asp-action="ConfirmBooking" class="flex-1 px-6 py-4 bg-coffee-accent text-white text-lg font-bold rounded-lg shadow-md hover:bg-coffee-dark transition-all duration-300 focus:ring-4 focus:ring-coffee-cream">
                        <i class="fas fa-check-circle mr-2"></i> CONFIRM BOOKING
                    </button>
                    <button type="submit" asp-action="SaveForLater" class="flex-1 px-6 py-4 bg-coffee-medium text-white text-lg font-bold rounded-lg shadow-md hover:bg-coffee-dark transition-all duration-300 text-center focus:ring-4 focus:ring-coffee-cream">
                        <i class="fas fa-bookmark mr-2"></i> SAVE FOR LATER
                    </button>
                </div>
            </form>
        </div>
    }
    else
    {
        <div class="max-w-md mx-auto mt-10 bg-white p-6 rounded-lg shadow-lg text-center">
            <div class="text-red-500 mb-4">
                <i class="fas fa-exclamation-circle text-5xl"></i>
            </div>
            <p class="text-red-500 font-semibold text-xl">Access Denied: Role not defined.</p>
            <p class="text-gray-600 mt-2">You will be redirected to the login page in 3 seconds.</p>
            <div class="mt-6 bg-gray-100 rounded-lg p-2">
                <div class="w-full bg-gray-300 rounded-full h-2">
                    <div class="bg-red-500 h-2 rounded-full animate-pulse"></div>
                </div>
            </div>
        </div>
        <script>
            setTimeout(function () {
                window.location.href = "/User/Login";
            }, 3000);
        </script>
    }
</div>

@if (TempData["Error"] != null)
{
    <div id="errorModal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50">
        <div class="bg-white p-6 rounded-xl shadow-2xl max-w-sm w-full transform transition-all duration-300 scale-100">
            <div class="flex items-center text-red-500 mb-4">
                <i class="fas fa-exclamation-circle text-2xl mr-3"></i>
                <h2 class="text-xl font-bold">Error</h2>
            </div>
            <p class="text-coffee-dark mb-4">@TempData["Error"]</p>
            <div class="flex justify-end">
                <button onclick="closeErrorModal()" class="bg-coffee-dark hover:bg-coffee-medium text-white px-4 py-2 rounded-lg transition-colors duration-300">
                    <i class="fas fa-times mr-2"></i> Close
                </button>
            </div>
        </div>
    </div>
}
<script>
    function updatePrice() {
        let basePrice = @Model.Price;
        let checkInDateInput = document.getElementById('checkInDate');
        let checkOutDateInput = document.getElementById('checkOutDate');
        let transportService = document.getElementById('transportService');
        let hiddenTotalPrice = document.getElementById('hiddenTotalPrice');

        const paymentOption = document.getElementById('paymentOption').value;
        document.getElementById('paymentType').textContent = paymentOption;

      
        let haveTransportService = transportService.checked;
        document.getElementById('hiddenTransportService').value = haveTransportService;



        let checkInDate = new Date(checkInDateInput.value);
        let checkOutDate = new Date(checkOutDateInput.value);

        // Prevent check-out date from being before check-in date
        if (checkOutDate <= checkInDate) {
            alert("Check-out date cannot be before or the same as check-in date.");
            checkOutDateInput.value = ""; // Reset check-out field
            return;
        }

        let numberOfNights = document.getElementById('numberOfNights');
        let numberOfNights2 = document.getElementById('numberOfNights2');
        let transportFee = document.getElementById('transportFee');
        let checkInDay = document.getElementById('checkInDay');
        let checkOutDay = document.getElementById('checkOutDay');
        let nightPrice = document.getElementById('nightPrice');

        let nights = (checkOutDate - checkInDate) / (1000 * 60 * 60 * 24);
        numberOfNights.textContent = nights;
        numberOfNights2.textContent = nights;

        let nightPriceAdded = ((basePrice * nights) - basePrice);
        let transportFeeAdded = haveTransportService ? 500.00 : 0.00;

        let formattedNightPrice = nightPriceAdded.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        let formattedTransportFee = transportFeeAdded.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

        checkInDay.textContent = checkInDate.toDateString();
        checkOutDay.textContent = checkOutDate.toDateString();
        nightPrice.textContent = formattedNightPrice;
        transportFee.textContent = formattedTransportFee;

        let totalPrice = (basePrice * nights) + transportFeeAdded;
        let currDeposit = 0;

        let depositPercent = 25;
        let finalDeposit = 0
        if (paymentOption === "Deposit" ){
            paymentTypeFinal.textContent = "(25%) Final Deposit";
            finalDeposit = totalPrice - ((totalPrice * (depositPercent / 100)));
            currDeposit = totalPrice * (depositPercent / 100);
            hiddenTotalBalance.value = finalDeposit;
        }
        else if (paymentOption === "Full Payment"){
            paymentTypeFinal.textContent = "No Deposit";
            hiddenTotalBalance.value = 0;
        }

        totalDeposit.textContent = formatPrice(currDeposit);


        let formattedTotalPrice = totalPrice.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        document.getElementById('totalPrice').textContent = formattedTotalPrice;
        hiddenTotalPrice.value = totalPrice;
    }

    function formatPrice(price) {
        return price.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    }

    function validateDates() {
        let checkInDateInput = document.getElementById('checkInDate');
        let checkOutDateInput = document.getElementById('checkOutDate');

        checkInDateInput.addEventListener("change", function () {
            let checkInDate = new Date(this.value);
            let minCheckOutDate = new Date(checkInDate);
            minCheckOutDate.setDate(minCheckOutDate.getDate() + 1);

            // Ensure check-out date is after check-in date
            if (checkOutDateInput.value) {
                let checkOutDate = new Date(checkOutDateInput.value);
                if (checkOutDate <= checkInDate) {
                    alert("Check-out date cannot be before or the same as check-in date.");
                    checkOutDateInput.value = ""; // Reset check-out field
                }
            }

            // Set minDate for check-out date picker
            checkOutDateInput.min = minCheckOutDate.toISOString().split("T")[0];
        });
    }

    function toggleTransportDetails() {
        updatePrice();
        const details = document.getElementById("transportDetails");
        const checkbox = document.getElementById("transportService");

        if (checkbox.checked) {
            details.classList.remove("hidden");
        } else {
            details.classList.add("hidden");
        }
    }


    function closeErrorModal() {
        document.getElementById("errorModal").style.display = "none";
    }

    document.addEventListener("DOMContentLoaded", function () {
        validateDates();

        var roomId = document.getElementsByName("RoomId")[0].value;
        let today = new Date();
        let tomorrow = new Date();
        tomorrow.setDate(tomorrow.getDate() + 1);

        fetch(`/GetUnavailableDates?roomId=${roomId}`)
            .then(response => response.json())
            .then(dates => {
                flatpickr(".datepicker", {
                    dateFormat: "Y-m-d",
                    disableMobile: "true",
                    disable: dates.map(date => new Date(date)),
                    minDate: tomorrow,
                    maxDate: new Date(today.getFullYear(), today.getMonth() + 12, today.getDate()),
                    prevArrow: "←",
                    nextArrow: "→"
                });
            });
    });

</script>
